
# **Developer Handover & Recreation Blueprint: Taco Vision**

## **1. Core Philosophy & Architecture**

This document outlines the complete technical and functional specification for the "Taco Vision" application. The goal is to enable a full recreation of the application from scratch.

**Core Mandate:** Build a sophisticated, real-time, multi-user inventory and team management application for a restaurant. The UI must be highly polished with a futuristic "space" aesthetic.

**Architectural Pillars:**

1.  **Server-Centric React (Next.js App Router):** The application heavily utilizes the Next.js App Router. UI is rendered on the server by default. Client-side interactivity is introduced where necessary (`"use client";`).
2.  **Real-time Database (Firebase/Firestore):** All application data is stored in and synchronized with Google Firestore. The UI subscribes to Firestore snapshots (`onSnapshot`) to update in real-time without requiring page reloads.
3.  **Component-Based UI (ShadCN):** The entire user interface is constructed using pre-built, accessible, and themeable components from the ShadCN UI library. Custom components are built by composing ShadCN primitives.
4.  **AI-Powered Features (Google Genkit):** Complex business logic, data analysis, and document processing are offloaded to AI models managed by Google's Genkit. This includes inventory forecasting, order calculation, and PDF parsing (OCR).
5.  **Custom Authentication:** A bespoke, simple, and secure PIN-based authentication system is used instead of traditional email/password logins.

---

## **2. Firebase & Data Model: The Single Source of Truth**

All application state is managed within Firestore. Understanding this data model is critical.

*   **`users` collection:**
    *   **Document ID:** Auto-generated by Firestore.
    *   **Purpose:** Stores user profiles and credentials.
    *   **Schema:**
        *   `name`: `string` (e.g., "Jane Doe")
        *   `id`: `string` (e.g., "0142") - This is the human-readable ID used for login.
        *   `pin`: `string` (e.g., "1234") - This is the 4-digit PIN for login. **Note:** For this project's scope, the PIN is stored as plaintext. In a production system, this MUST be hashed.
        *   `role`: `string` - An enum of `"Team Training"`, `"Manager"`, or `"Admin Manager"`. This controls authorization for features.
        *   `lastLogin`: `Timestamp` - A Firestore timestamp updated on each successful login.

*   **`inventory` collection:**
    *   **Document ID:** Auto-generated by Firestore.
    *   **Purpose:** The master list of all inventory items.
    *   **Schema:**
        *   `name`: `string` (e.g., "Ground Beef")
        *   `category`: `string` - An enum (`'Protein'`, `'Dairy'`, etc.) for filtering and organization.
        *   `stock`: `number` - The current quantity on hand.
        *   `threshold`: `number` - The minimum quantity that should be on hand. When `stock` falls below this, it is considered "Low Stock".
        *   `type`: `string` - An enum of `'Permanent'` or `'Limited Time'`.

*   **`auditLogs` collection:**
    *   **Document ID:** Auto-generated by Firestore.
    *   **Purpose:** An immutable, append-only log of all significant actions taken in the app.
    *   **Schema:**
        *   `user`: `string` - The name of the user who performed the action.
        *   `action`: `string` (e.g., "added_item", "updated_stock").
        *   `item`: `string` - A description of the item affected (e.g., the item name or a summary like "5 items").
        *   `timestamp`: `serverTimestamp()` - Automatically generated by Firestore on creation.

*   **`schedules` collection:**
    *   **Document ID:** A **custom-generated string** based on the week, e.g., `week-2024-05-22`. This allows for direct lookup of the current week's schedule.
    *   **Purpose:** Stores the parsed weekly work schedule for all employees.
    *   **Schema:**
        *   `uploadedAt`: `serverTimestamp()`
        *   `entries`: `array` - A list of objects, where each object is a single shift.
            *   **Shift Object Schema:** `name`, `userId`, `dayOfWeek`, `timeRange`, `hoursWorked` (all strings, as parsed by the AI).

*   **`settings` collection:**
    *   **Document ID:** A hardcoded, singleton document ID: `"budget"`.
    *   **Purpose:** Stores global application settings.
    *   **Schema:**
        *   `budget`: `number` - The total weekly budget.
        *   `spent`: `number` - The amount of the budget spent.
        *   `overstockThreshold`: `number` - A multiplier used to determine if an item is overstocked (e.g., if `stock > threshold * overstockThreshold`).

---

## **3. Authentication Flow (PIN-based)**

The login process avoids traditional sessions and relies on `sessionStorage` for simplicity.

1.  **User Input:** The user enters their User ID and 4-digit PIN on the login page (`src/app/page.tsx`).
2.  **Firestore Query:** On submission, the `LoginForm` component (`src/components/auth/login-form.tsx`) queries the `users` collection. It looks for a document `where("id", "==", inputId)`.
3.  **PIN Verification:** If a document is found, it **client-side** compares the `pin` from the document with the user's input PIN.
4.  **Session Storage:** If the PIN matches, the entire user document (including name, role, etc.) is serialized into a JSON string and stored in the browser's `sessionStorage` under the key `taco-vision-user`.
5.  **Redirection:** The user is redirected to the `/dashboard`.
6.  **Auth Provider:** A root layout `AuthProvider` (`src/components/auth/auth-provider.tsx`) wraps all dashboard pages. On every navigation, it checks `sessionStorage` for the `taco-vision-user` key. If the key exists, it parses the user data and provides it via a React Context. If the key is missing, it redirects the user back to the login page. This protects all dashboard routes.
7.  **Logout:** The logout button simply removes the `taco-vision-user` key from `sessionStorage` and redirects to the login page.

---

## **4. Genkit AI Flows: The "Brain"**

All complex logic is handled by Genkit flows defined in `src/ai/flows/`. These are server-side TypeScript functions called from the client-side components.

*   **`schedule-ocr.ts` (`extractSchedule`):**
    *   **Input:** A PDF file encoded as a Base64 data URI.
    *   **Process:** The flow uses a `googleai` model with multimodal capabilities. The prompt instructs the model to act as a data-extraction assistant, parsing the visual layout of the PDF to find employee names, user IDs, shift times, and days. It explicitly tells the model to calculate the total hours for each shift.
    *   **Output:** A structured JSON object containing an array of `ScheduleEntry` objects. This structured data is then sent back to the `ScheduleManagement` component for display and saving.

*   **`inventory-forecasting.ts` (`forecastInventory`):**
    *   **Input:** Text fields containing sample historical data, the day of the week to predict for, and observed sales patterns.
    *   **Process:** This flow uses a standard text-based `googleai` model. The prompt instructs the model to act as an expert inventory manager, analyzing the provided text to identify trends and make a prediction.
    *   **Output:** A JSON object with two string fields: `predictedNeeds` and `potentialRisks`.

*   **`shipment-calculation.ts` (`calculateShipment`):**
    *   **Input:** A single, newline-separated string containing the current inventory list (item name, stock, threshold).
    *   **Process:** This is a logic-based text-generation task. The prompt instructs the model to calculate the difference between the threshold and the stock for each item and to format the result as a spreadsheet-style string.
    *   **Output:** A JSON object with a single string field, `shipmentList`, containing the formatted report.

---

## **5. Visual Design & UI/UX "Down to the Pixel"**

The visual identity is critical. It must be a dark, futuristic "space" theme.

*   **Global Styles (`src/app/globals.css`):**
    *   **Font:** 'Inter' must be imported from Google Fonts and applied to the `body`.
    *   **Background:** The background is a multi-layered, animated effect.
        1.  **Animated Gradient:** A `linear-gradient` with multiple color stops is animated by changing its `background-position` over 25 seconds.
        2.  **Static Radial Gradients:** Two `radial-gradient` layers are placed on top to add depth at the top and bottom of the viewport.
        3.  **Starfield:** A repeating SVG background image (`data:image/svg+xml,...`) is used to create a starfield. This layer is animated by translating its position over 150 seconds, creating a slow, parallax scrolling effect.
    *   **ShadCN Theme:** The `:root` CSS variables for ShadCN are explicitly defined to create the color scheme.
        *   `--background`: `26 20% 5%` (A very dark, almost-black with a hint of brown)
        *   `--primary`: `350 90% 50%` (A vibrant, strong crimson/red)
        *   `--card`: `26 20% 9%` (Slightly lighter than the main background to make cards subtly stand out)
        *   Other colors (`--accent`, `--border`, etc.) are derived from this core theme.

*   **Layout & Motion (`src/app/dashboard/layout.tsx`):**
    *   **Sidebar:** The layout uses a custom `SidebarProvider` component (from `src/components/ui/sidebar.tsx`). The sidebar itself (`AppSidebar`) is collapsible, transitioning between a full view (`16rem`) and an icon-only view (`3rem`).
    *   **Page Transitions:** Navigation is intercepted by a custom `AppContext`. When `navigateTo` is called, it sets an `isNavigating` state to `true`. This triggers `framer-motion`'s `AnimatePresence`.
        1.  The main page content gets a `blur-sm` CSS filter applied.
        2.  An overlay appears with a `TacoIcon` in the center.
        3.  The icon uses `framer-motion` to animate its scale, opacity, and rotation, creating a gentle pulsing effect while the next page loads.
        4.  When Next.js signals the new page is ready, `isNavigating` becomes `false`, and the overlay and blur fade out.

This level of detail should provide everything needed for a complete and faithful recreation of the application.